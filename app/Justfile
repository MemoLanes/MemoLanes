# Justfile

# Default full build pipeline
play-build:
    @echo "\nğŸš€ Starting Play build pipeline"
    just check-node
    just build-kernel
    just generate-bridge
    @echo "âœ… Play build completed\n"

# Generate authentication token
token:
    @echo "\nğŸ” Generating access token"
    @python3 setup_token.py
    @echo "âœ… Token file created successfully"

# Flutter application runner
flutter-run:
    @echo "\nğŸ“± Launching Flutter application"
    @flutter run -v

check-node:
    @echo "\nğŸ”§ System Environment Check:"

    # Node.js verification
    @if ! command -v node &> /dev/null; then \
        echo "  â€¼ï¸  Node.js: Missing (Required for kernel build)"; \
        echo "     Download: https://nodejs.org/"; \
        exit 1; \
    else \
        echo "  âœ“ Node.js: Installed"; \
    fi

    # Yarn package manager check
    @if ! command -v yarn &> /dev/null; then \
        echo "  â€¼ï¸  Yarn: Missing (Required dependency manager)"; \
        echo "     Install: https://classic.yarnpkg.com/en/docs/install"; \
        exit 1; \
    else \
        echo "  âœ“ Yarn: Installed"; \
    fi

    # Flutter-Rust bridge tool verification
    @if ! command -v flutter_rust_bridge_codegen &> /dev/null; then \
        echo "  â€¼ï¸  Flutter Rust Bridge: Missing (Critical for code generation)"; \
        echo "     Install: cargo install flutter_rust_bridge_codegen"; \
        exit 1; \
    else \
        echo "  âœ“ Flutter Rust Bridge: Installed"; \
    fi

    @echo "âœ… Environment validation passed"

# Kernel compilation task
build-Journeykernel:
    @echo "\nğŸ› ï¸  Building Journey Kernel"
    @cd journey_kernel && yarn build
    @echo "âœ… Kernel build completed"

# Bridge code generation
frb-generate:
    @echo "\nğŸ”— Generating Rust Bridge Bindings"
    @flutter_rust_bridge_codegen generate
    @echo "âœ… Bridge code generation completed"